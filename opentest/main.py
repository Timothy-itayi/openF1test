from flask import Flask, render_template
from helpers import get_driver_standing, get_team_standing

app = Flask(__name__)

@app.route("/teams")
def teams():

    # Fetch current standings for 2024 season
    current_team_data = get_team_standing("8ac404c1-7494-4b04-b8a6-ee97913de526")
    
    teams = []

    if current_team_data is not None and isinstance(current_team_data, dict) and "items" in current_team_data:
        items = current_team_data["items"]
        for item in items:
            team_info = {
                'name': item.get('name', ''),
                'short_name': item.get('shortName', ''),
                'full_name': item.get('fullName', ''),
                'color': item.get('color', ''),
                'position': item.get('standing', {}).get('position', ''),
                'points': item.get('standing', {}).get('points', '')
            }
            teams.append(team_info)

    return render_template('teams.html', teams=teams)

@app.route("/")
def index():


    return render_template('layout.html')
    

@app.route('/drivers')
def drivers():
    # Fetch data for drivers
    current_driver_data = get_driver_standing("8ac404c1-7494-4b04-b8a6-ee97913de526")
   
    drivers = []

    if current_driver_data is not None and isinstance(current_driver_data, dict) and "items" in current_driver_data:
        items = current_driver_data["items"]
        for item in items:
            standing = item.get("standing", {})
            constructors = item.get("constructors", [])
            if constructors:
                team = constructors[0].get("fullName", "")
            else:
                team = ""
            driver_info = {
                'name': f"{item.get('firstName', '')} {item.get('lastName', '')}",
                'team': team,
                'number': item.get('number', ''),
                'points': standing.get('points', ' '),
                'position': standing.get('position', '')


            }
            drivers.append(driver_info)

    return render_template('drivers.html', drivers=drivers)


if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8080, debug=True)