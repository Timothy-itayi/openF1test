from flask import Flask, render_template
from helpers import get_f1_data, get_current_standing

app = Flask(__name__)

@app.route("/")
def index():

    # Fetch current standings for 2024 season
    current_standing = get_current_standing("8ac404c1-7494-4b04-b8a6-ee97913de526")

    
    # Render the index.html template
    return render_template('layout.html', standings=current_standing)


@app.route('/drivers')
def drivers():
    # Fetch data for drivers
    current_driver_data = get_f1_data("8ac404c1-7494-4b04-b8a6-ee97913de526")
    current_standing = get_current_standing("8ac404c1-7494-4b04-b8a6-ee97913de526")
    drivers = []

    if current_driver_data is not None and isinstance(current_driver_data, dict) and "items" in current_driver_data:
        items = current_driver_data["items"]
        for item in items:
            standing = item.get("standing", {})
            constructors = item.get("constructors", [])
            if constructors:
                team = constructors[0].get("fullName", "")
            else:
                team = ""
            driver_info = {
                'name': f"{item.get('firstName', '')} {item.get('lastName', '')}",
                'team': team,
                'number': item.get('number', ''),
                'points': standing.get('points', ' '),
                'position': standing.get('position', '')


            }
            drivers.append(driver_info)

    return render_template('drivers.html', drivers=drivers, standings=current_standing)


if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8080, debug=True)